# Unity MCP 日志功能指南

## 概述

Unity MCP插件现在提供了详细的日志记录功能，可以追踪AI工具的所有操作，包括接口调用、参数传递、执行结果等。

## 日志特性

### 🚀 服务器生命周期日志
- 服务器启动/停止状态
- 监听地址和端口信息
- 已注册工具列表
- 客户端连接统计

### 🌐 HTTP请求日志
- 客户端IP地址和端点信息
- 完整的HTTP请求和响应
- 请求体和响应体内容
- 错误处理和异常信息

### 📋 JSON-RPC处理日志
- 接收到的JSON-RPC请求
- 方法名称和参数
- 处理状态和结果
- 错误代码和消息

### 🔧 工具调用日志
- 工具名称和调用时间
- 传入参数的详细信息
- 执行成功/失败状态
- 执行耗时统计
- 返回结果内容

### 👥 客户端连接跟踪
- 新客户端连接记录
- 客户端活动状态
- 最后执行的工具
- 断开连接检测

## 日志格式

所有日志都使用统一的格式：
```
[MCP] [时间戳] 🔥 日志内容
```

### 时间戳格式
```
yyyy-MM-dd HH:mm:ss.fff
例如: 2024-01-15 14:30:25.123
```

### 日志图标说明
- 🚀 服务器启动
- 🛑 服务器停止
- ✅ 操作成功
- ❌ 操作失败
- 🌐 网络相关
- 📋 工具列表
- 🔧 工具调用
- 👥 客户端连接
- 📝 参数信息
- ⏱️ 执行时间
- 📤 响应结果
- 🔍 错误详情

## 如何查看日志

### 在Unity Editor中
1. 打开Unity Editor
2. 打开 **Window > Console** 窗口
3. 启动MCP服务器
4. 所有MCP相关日志都会显示在Console中

### 日志过滤
在Unity Console中，可以通过以下方式过滤MCP日志：
- 在搜索框中输入 `[MCP]` 只显示MCP相关日志
- 使用 `🚀` `🔧` 等图标进行更精确的过滤

## 示例日志输出

### 服务器启动
```
[MCP] [2024-01-15 14:30:25.123] 🚀 Unity MCP服务器启动成功
[MCP] [2024-01-15 14:30:25.124] 🌐 监听地址: http://localhost:8080/mcp
[MCP] [2024-01-15 14:30:25.125] 🔧 已注册工具数量: 8
[MCP] [2024-01-15 14:30:25.126] 📋 可用工具: list_scenes, open_scene, play_mode_start, play_mode_stop, create_gameobject, add_component, set_transform, import_asset
```

### 客户端连接
```
[MCP] [2024-01-15 14:30:30.456] 👥 新客户端连接: 127.0.0.1:54321
[MCP] [2024-01-15 14:30:30.457] 📝 客户端信息: Unity MCP Demo Client v1.0.0
```

### 工具调用
```
[MCP] [2024-01-15 14:30:35.789] 🔧 开始执行工具: create_gameobject
[MCP] [2024-01-15 14:30:35.790] 📝 工具参数: {"name":"TestCube","parent":""}
[MCP] [2024-01-15 14:30:35.850] ✅ 工具执行成功: create_gameobject (耗时: 60ms)
[MCP] [2024-01-15 14:30:35.851] 📤 返回结果: GameObject 'TestCube' created successfully
```

### 错误处理
```
[MCP] [2024-01-15 14:30:40.123] ❌ 工具执行失败: nonexistent_tool
[MCP] [2024-01-15 14:30:40.124] 🔍 错误详情: Tool 'nonexistent_tool' not found
```

## 测试日志功能

### 使用演示脚本
运行提供的演示脚本来测试日志功能：

```bash
python demo_mcp_logging.py
```

这个脚本会：
1. 连接到Unity MCP服务器
2. 执行各种工具调用
3. 测试错误处理
4. 在Unity Console中生成详细的日志

### 手动测试
你也可以使用任何HTTP客户端（如Postman、curl等）向MCP服务器发送请求：

```bash
# 获取工具列表
curl -X POST http://localhost:8080/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":1,"method":"tools/list","params":{}}'

# 调用工具
curl -X POST http://localhost:8080/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":2,"method":"tools/call","params":{"name":"list_scenes","arguments":{}}}'
```

## 日志配置

### 启用/禁用日志
目前所有日志都通过Unity的 `Debug.Log` 系统输出。你可以通过以下方式控制日志显示：

1. **Unity Console设置**：在Console窗口中使用过滤器
2. **构建设置**：在发布版本中，Debug.Log会被自动优化掉
3. **代码修改**：如需完全禁用，可以注释掉McpServer.cs中的Debug.Log语句

### 性能考虑
- 日志记录对性能影响很小
- 在发布版本中，Debug.Log语句会被Unity自动移除
- 大量并发请求时，日志可能会影响Console的响应速度

## 故障排除

### 常见问题

**Q: 看不到MCP日志**
A: 确保Unity Console窗口已打开，并且没有被过滤器隐藏

**Q: 日志太多，影响性能**
A: 使用Console的搜索功能过滤特定类型的日志

**Q: 想要保存日志到文件**
A: 可以修改McpServer.cs，将Debug.Log改为文件写入

### 调试技巧

1. **使用时间戳**：所有日志都包含精确的时间戳，便于追踪操作序列
2. **关注错误日志**：错误日志包含详细的堆栈信息
3. **监控执行时间**：工具调用日志包含执行耗时，便于性能分析
4. **追踪客户端**：通过IP地址可以区分不同的客户端连接

## 扩展日志功能

如果需要更高级的日志功能，可以考虑：

1. **日志级别**：添加DEBUG、INFO、WARN、ERROR等级别
2. **日志文件**：将日志输出到文件而不是Console
3. **结构化日志**：使用JSON格式的结构化日志
4. **日志聚合**：集成第三方日志系统
5. **性能监控**：添加更详细的性能指标

## 总结

通过这些详细的日志，你可以：
- 🔍 **追踪AI操作**：清楚地看到AI工具调用了哪些接口
- 📊 **监控性能**：了解每个操作的执行时间
- 🐛 **调试问题**：快速定位错误和异常
- 📈 **分析使用情况**：了解哪些工具被频繁使用
- 🔒 **安全审计**：记录所有的外部访问和操作

这些日志信息对于开发、调试和监控Unity MCP插件都非常有价值。