# Unity线程信息工具使用指南

## 概述

`get_thread_info` 工具是Unity MCP插件的新功能，用于获取Unity编辑器和运行时的详细线程信息。这对于调试多线程问题、性能优化和了解Unity的线程架构非常有用。

## 功能特性

### 🧵 当前线程信息
- 线程ID和名称
- 是否为后台线程
- 线程状态
- 是否为线程池线程

### 🎯 Unity主线程信息
- 主线程ID识别
- 当前是否在主线程执行
- 编辑器模式状态
- 播放模式状态

### 💻 系统进程信息
- 进程ID和名称
- 总线程数量
- 内存使用情况

### 🔄 线程池状态
- 可用工作线程数量
- 最大工作线程数量
- IO完成端口线程信息
- 当前使用中的线程统计

## 使用方法

### 1. 通过MCP客户端调用

```python
# 使用MCP客户端调用
result = await session.call_tool("get_thread_info", {})
print(result.content[0].text)
```

### 2. 直接在Unity编辑器中使用

```csharp
// 在Unity编辑器脚本中直接调用
var result = UnityTools.GetThreadInfo(new JObject());
Debug.Log(result.Content[0].Text);
```

## 输出示例

```
Unity线程信息:
- 当前线程ID: 1
- 当前线程名称: 主线程
- 是否后台线程: False
- 线程状态: Running
- 是否线程池线程: False

Unity主线程信息:
- 主线程ID: 1
- 是否在主线程: True
- 编辑器模式: True
- 播放模式: False

系统进程信息:
- 进程ID: 12345
- 进程名称: Unity
- 线程数量: 25
- 工作集内存: 512 MB

线程池信息:
- 可用工作线程: 1023
- 最大工作线程: 1023
- 可用IO完成端口线程: 1000
- 最大IO完成端口线程: 1000
- 使用中工作线程: 0
- 使用中IO线程: 0
```

## 应用场景

### 🐛 调试多线程问题
- 确认代码是否在主线程执行
- 检查线程池使用情况
- 识别线程死锁或阻塞

### ⚡ 性能优化
- 监控线程池资源使用
- 分析内存使用模式
- 优化线程调度策略

### 📊 系统监控
- 实时查看Unity进程状态
- 监控线程数量变化
- 跟踪内存使用趋势

## 注意事项

1. **线程安全**: 此工具本身是线程安全的，可以从任何线程调用
2. **性能影响**: 获取线程信息的开销很小，适合频繁调用
3. **编辑器限制**: 某些信息仅在Unity编辑器中可用
4. **平台差异**: 不同平台的线程实现可能有差异

## 故障排除

### 常见问题

**Q: 为什么显示"获取线程信息失败"？**
A: 可能是权限问题或系统API不可用，检查Unity控制台的详细错误信息。

**Q: 线程ID为什么会变化？**
A: 这是正常的，特别是在编辑器模式下，Unity可能会重新创建线程。

**Q: 如何判断是否在主线程？**
A: 查看"是否在主线程"字段，或比较当前线程ID与主线程ID。

## 相关工具

- `get_play_mode_status`: 获取播放模式状态
- `get_current_scene_info`: 获取当前场景信息

## 更新日志

- **v1.0.0**: 初始版本，支持基本线程信息获取
- 添加了当前线程、主线程、进程和线程池信息
- 支持编辑器和运行时模式

---

💡 **提示**: 建议在调试复杂的多线程问题时，结合Unity Profiler一起使用，可以获得更全面的性能分析数据。